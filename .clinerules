# Project Guidelines

You are an expert FPGA and embedded engineer, proficient in VHDL, Verilog, SystemVerilog, python, TCL, etc. All your non-testbench should be synthesizable, adhering to coding guidelines such as https://docs.amd.com/r/en-US/ug901-vivado-synthesis/HDL-Coding-Techniques. The code for testbenches must should use all the powers of the language.


# Documentation Requirements
- Update relevant documentation in /docs when modifying features
- Keep README.md in sync with new capabilities
- Maintain changelog entries in CHANGELOG.md

# General Guidelines
- Your generated code ALWAYS has 2 spaces tab indentation. If existing code has a different indentation size/style ask first.
- If I tell you that you are wrong, think about whether or not you think that's true and respond with facts
- Avoid apologizing or making conciliatory statements
- It is not necessary to agree with the user with statements such as "You're right" or "Yes"
- Avoid hyperbole and excitement, stick to the task at hand and complete it pragmatically
- Always look for existing code to iterate on instead of creating new code
- Do not drastically change the patterns before trying to iterate on existing patterns
- Prefer simple solutions
- Avoid duplication of code whenever possible, which means checking for other areas of the codebase that might already have similar code and functionality
- Write code that takes into account the different environments: dev, test, and prod
- You are careful to only make changes that are requested or you are confident are well understood and related to the change being requested
- When fixing an issue or bug, do not introduce a mew pattern or technology without first exhausting all options for the existing implementation. And if you finally do this, make sure to remove the old implementation afterwards so we don't have duplicate logic
- Keep the codebase very clean and organized
- Avoid having files over 400-600 limes of code. Refactor at that point
- Focus om the areas of code relevant to the task
- Do not touch code that is unrelated to the task
- Write thorough tests for all major functionality
- Avoid making major changes to the patterns and architecture of how a feature works, after it has shown to work well, unless explicitly instructed
- Always think about what other methods and areas of code might be affected by code changes


# FPGA, Vivado, RTL best practices

## Modular Design & Code Organization
- **Divide and Conquer**: Structure your FPGA design into small, reusable modules. Modular design not only enhances readability but also improves testability, helping with code reuse across different projects
- **Top-down Design Flow**: Start with a top-level design module and gradually break it down into sub-modules. Ensure clear, well-defined interfaces between these modules using `interface` blocks in SystemVerilog

## Synchronous Design Principles
- **Clock Domain Consistency**: Use a single clock domain wherever possible to simplify timing analysis and avoid unnecessary complexity. For designs requiring multiple clocks, ensure proper handling of **clock domain crossing (CDC)**.
- **Synchronous Reset**: Favor synchronous reset over asynchronous reset in your design to ensure predictable behavior. All flip-flops should reset in sync with the clock to avoid timing hazards during synthesis.

## Timing Closure & Constraints
- **Define Timing Constraints Early**: Set up timing constraints using **XDC (Xilinx Design Constraints)** files early in the design process. Regularly review the **Static Timing Analysis (STA)** reports to catch setup and hold violations.
- **Critical Path Optimization**: Identify critical timing paths using Vivado's timing reports. Address violations by adding pipeline stages or optimizing logic, and consider multi-cycle path constraints where necessary.
- **Pipelining**: Use pipelining to manage combinatorial logic delays, particularly in high-frequency designs. This reduces the load on critical paths and enhances overall timing performance.

## Resource Utilization & Optimization
- **LUT, FF, and BRAM Efficiency**: Optimize the use of LUTs, flip-flops, and block RAM by writing efficient SystemVerilog code. Use `reg []` for inferring RAM structures and avoid excessive usage of registers for signal storage.
- **Vivado IP Cores**: Leverage Vivado's built-in IP cores (e.g., **AXI interfaces**, **DSP blocks**, **memory controllers**) to accelerate design and resource utilization. Properly configure these IP blocks to meet your system's performance requirements.
- **Optimization During Synthesis**: Choose the appropriate synthesis strategy in Vivado based on design priorities (e.g., area optimization vs. speed optimization). Vivado's reports provide detailed feedback on resource usage, guiding further improvements.

### Power Optimization
- **Clock Gating**: Implement clock gating techniques where possible to reduce dynamic power consumption. Only enable clocks for specific modules when they are in use.
- **Power-Aware Synthesis**: Vivado supports power-aware synthesis. Set power constraints to help optimize the design for low-power applications.

### Debugging & Simulation
- **Testbenches**: Write detailed, self-checking testbenches that cover both typical use cases and edge cases. Use SystemVerilog's `assert` statements to check key assumptions in your design during simulation.
- **Vivado Simulation**: Run behavioral and post-synthesis simulations in Vivado to verify functionality. Use Vivado's **Integrated Logic Analyzer (ILA)** for in-system debugging of signals in real-time.
- **Assertion-Based Verification**: Use SystemVerilog assertions (`assert`) in both testbenches and within modules to catch unexpected behavior, such as protocol violations or out-of-range conditions.

### Advanced Techniques
- **Clock Domain Crossing (CDC)**: Use safe techniques like synchronizers or FIFOs to handle clock domain crossings effectively. Avoid metastability by properly synchronizing signals between different clock domains.
- **High-Performance AXI Transfers**: For high-speed data transfers, integrate Vivado's AXI-based IPs. Optimize AXI interfaces for high-throughput applications by ensuring correct burst sizes and handling backpressure gracefully.
- **Latency Reduction**: When dealing with critical paths or performance-sensitive modules, implement fine-tuned pipeline stages to reduce latency without sacrificing system throughput.


#AXI Protocols

### Best Practices for AXI Protocols
- **AXI Protocol Compliance**: Ensure that your design adheres to the AXI protocol specifications, including proper management of read/write channels, ready/valid handshakes, and address arbitration.
- **AXI-DMA Integration**: For high-performance DMA transfers, integrate Vivado's **AXI-DMA IP core**. Configure the DMA for burst transfers to maximize throughput and minimize bus contention.
- **Backpressure Handling**: Implement robust backpressure handling to prevent data loss during high-speed transfers. Ensure that your design can handle cases where the downstream module is not ready to accept data.
- **Buffer Alignment**: For maximum efficiency, ensure proper buffer alignment when transferring data between the AXI-DMA engine and memory. Misaligned buffers can result in additional overhead and reduced throughput.
- **Latency and Throughput Optimization**: Use pipelining and burst transfers to balance latency and throughput in AXI systems. Leverage Vivado's performance analysis tools to identify and mitigate bottlenecks.

### AXI Protocols Debugging and Verification
- **Simulation of AXI Interfaces**: Use Vivado's AXI protocol checker to ensure your AXI transactions are correct. Perform simulations to verify that the data transfer mechanism works under different scenarios and with different traffic loads.
- **Real-Time Debugging with ILA**: When debugging in real hardware, use Vivado's Integrated Logic Analyzer (ILA) to capture AXI transactions in real time. This helps verify the correct implementation of the AXI protocol and DMA transfers.


----

# Curent File Structure
    hdmi_io1.xpr.zip
    hdmi_io_bak.xpr.zip
    vivado_hls.log
    barrel_distortion_correction/
        .clinerules
        .gitignore
        README.md
        compile_rtl_xvlog.sh
        hls_brl_corr1.zip
        hls_brl_corr_src_brl_corr_hls.cpp
        image_to_raw.py
        raw_to_image.py
        run.tx
        run_vivado_xsim.sh
        setup_vivado_git_bash.sh
        vivado_hls.log
        -/
            run_xsim_in_new_msys.sh
            setup_vivado_git_bash.sh
            setup_vivado_msys_fixed.sh
            temp_setup.sh
        hdmi_io/
        hls/
            vivado_hls.log
        hls_brl_corr/
            .cproject
            .project
            .vivado_hls_log_all.xml
            run_csim.tcl
            sim_csim.sh
            vivado_hls.app
        hls_brl_corr0/
            .cproject
            .project
            .vivado_hls_log_all.xml
            run_csim.tcl
            sim_csim.sh
            vivado_hls.app
            vivado_hls.log
        hls_brl_corr1/
            .cproject
            .project
            .vivado_hls_log_all.xml
            run_csim.tcl
            sim_csim-.sh
            sim_csim.sh
            vivado_hls.app
        hls_brl_corr2/
            .cproject
            .project
            .vivado_hls_log_all.xml
        hls_brl_corr2023/
            .cproject
            .project
            .vitis_hls_log_all.xml
            hls.app
        hls_brl_corr3/
            .cproject
            .gitignore
            .project
            .vivado_hls_log_all.xml
            vivado_hls.app
        scripts/
            update_clinerules_file_tree.py
        vivado/
            hdmi_barrel_distortion_correction.bd.pdf
            hdmi_barrel_distortion_correction.xpr
        vivado1/
            hdmi_barrel_distortion_correction.bd.pdf
            hdmi_barrel_distortion_correction.xpr
    barrel_distortion_correction1/
        hls_brl_corr/
            .cproject
            .project
            .vivado_hls_log_all.xml
        hls_brl_corr0/
            .cproject
            .project
            vivado_hls.app
    barrel_distortion_correction2/
        vivado_hls.log
        hls_brl_corr/
            .cproject
            .gitignore
            .project
            .vivado_hls_log_all.xml
            vivado_hls.app
        hls_brl_corr1/
            .cproject
            .project
            vivado_hls.app
    brl_corr/
        .clinerules
        .gitignore
        README.md
        vivavdo/
            brl_corr.xpr
    BYU_PYNQ_PR_Video_Pipeline/
        LICENSE
        README.md
        ToDo.txt
        log.txt
        logo.png
        setup.py
        video/
            .partial_bit.py.swp
            PRControl.py
            __init__.py
            ascii_l0.bit
            ascii_m0.bit
            ascii_m1.bit
            ascii_m2.bit
            ascii_s0.bit
            ascii_s1.bit
            ascii_s2.bit
            ascii_s3.bit
            ascii_s4.bit
            ascii_s5.bit
            build_base_ip.tcl
            constants.py
            dilate_l0.bit
            dilate_m0.bit
            dilate_m1.bit
            dilate_m2.bit
            dilate_s0.bit
            dilate_s1.bit
            dilate_s2.bit
            dilate_s3.bit
            dilate_s4.bit
            dilate_s5.bit
            emboss_l0.bit
            emboss_m0.bit
            emboss_m1.bit
            emboss_m2.bit
            emboss_s0.bit
            emboss_s1.bit
            emboss_s2.bit
            emboss_s3.bit
            emboss_s4.bit
            emboss_s5.bit
            erode_l0.bit
            erode_m0.bit
            erode_m1.bit
            erode_m2.bit
            erode_s0.bit
            erode_s1.bit
            erode_s2.bit
            erode_s3.bit
            erode_s4.bit
            erode_s5.bit
            grey_l0.bit
            grey_m0.bit
            grey_m1.bit
            grey_m2.bit
            grey_s0.bit
            grey_s1.bit
            grey_s2.bit
            grey_s3.bit
            grey_s4.bit
            grey_s5.bit
            gscreen_mux.bit
            image_l0.bit
            invert_l0.bit
            invert_m0.bit
            invert_m1.bit
            invert_m2.bit
            invert_s0.bit
            invert_s1.bit
            invert_s2.bit
            invert_s3.bit
            invert_s4.bit
            invert_s5.bit
            japanese_l0.bit
            japanese_m0.bit
            japanese_m1.bit
            japanese_m2.bit
            japanese_s0.bit
            japanese_s1.bit
            japanese_s2.bit
            japanese_s3.bit
            japanese_s4.bit
            japanese_s5.bit
            kernel_l0.bit
            kernel_m0.bit
            kernel_m1.bit
            kernel_m2.bit
            limit_l0.bit
            limit_m0.bit
            limit_m1.bit
            limit_m2.bit
            limit_s0.bit
            limit_s1.bit
            limit_s2.bit
            limit_s3.bit
            limit_s4.bit
            limit_s5.bit
            lines_l0.bit
            lines_m0.bit
            lines_m1.bit
            lines_m2.bit
            lines_s0.bit
            lines_s1.bit
            lines_s2.bit
            lines_s3.bit
            lines_s4.bit
            lines_s5.bit
            mirror_l0.bit
            mirror_m0.bit
            mirror_m1.bit
            mirror_m2.bit
            mirror_s0.bit
            mirror_s1.bit
            mirror_s2.bit
            mirror_s3.bit
            mirror_s4.bit
            mirror_s5.bit
            mton_l0.bit
            partial_bit.py
            pass_l0.bit
            pass_m0.bit
            pass_m1.bit
            pass_m2.bit
            pass_s0.bit
            pass_s1.bit
            pass_s2.bit
            pass_s3.bit
            pass_s4.bit
            pass_s5.bit
            sobel_l0.bit
            sobel_m0.bit
            sobel_m1.bit
            sobel_m2.bit
            threshold_l0.bit
            threshold_m0.bit
            threshold_m1.bit
            threshold_m2.bit
            threshold_s0.bit
            threshold_s1.bit
            threshold_s2.bit
            threshold_s3.bit
            threshold_s4.bit
            threshold_s5.bit
            video.bit
            video.bit.old
            video.py
            video.tcl
        Video_notebooks/
            ASCII test overlay.ipynb
            BYU_Stretch_Y.bin
            Demo-.ipynb
            Demo.ipynb
            Demo0.ipynb
            Dilate Filter.ipynb
            Emboss Filter.ipynb
            Erode.ipynb
            Grayscale.ipynb
            Green Screen.ipynb
            Image Overlay.ipynb
            Invert Filter.ipynb
            Japanese Text Overlay.ipynb
            Kernel Filter.ipynb
            Line Overlay.ipynb
            MIrror.ipynb
            RGB Filter.ipynb
            Sobel Filter.ipynb
            Threshold Filter.ipynb
            background.jpg
            background2.jpg
            background3.jpg
            cougar_256.bin
            medallion_256.bin
    BYU_PYNQ_PR_Video_Pipeline_HW/
        .gitignore
        README.md
        Task Completed.docx
        setup_vivado_msys_custom.sh
        doc/
            lut_create.py
            system.bd.pdf
            system.bd.png
            system.bd.video.pdf
            system.bd.video.png
        drp/
            build_prs.tcl
            build_static_design+.log
            build_static_design.log
            build_static_design.tcl
            part_gen.log
            part_gen.tcl
            part_gen_large.tcl
            part_gen_mid.tcl
            part_gen_mux.tcl
            part_gen_small.tcl
        ip/
        Pynq-Z1/
    HDMI17/
        HDMI17.bak.xpr
        HDMI17.xpr
        ip_upgrade.log
        HDMI17.cache/
        HDMI17.hw/
            HDMI17.lpr
        HDMI17.ip_user_files/
            README.txt
        HDMI17.runs/
        HDMI17.sim/
        HDMI17.srcs/
    HDMI_02/
        HDMI_02.xpr
        design_1.pdf
        .Xil/
        HDMI_02.cache/
        HDMI_02.hw/
            HDMI_02.lpr
        HDMI_02.ip_user_files/
            README.txt
        HDMI_02.runs/
        HDMI_02.sim/
        HDMI_02.srcs/
        Zybo-Z7-20-HDMI-v2018.2-2/
            README.md
    hdmi_barrel_distortion_correction/
    hls/
        barrel_correction.cpp
        barrel_correction.h
        barrel_correction1.cpp
        barrel_correction_tb.cpp
        hls_barrel_correction/
            .cproject
            .project
            vivado_hls.app
    pynqz2_dpu140/
        README.md
        apps/
            Makefile
        images/
            2019-09-03_23h20_33.png
            2019-09-03_23h22_30.png
            2019-09-04_09h07_12.png
            2019-09-04_11h33_32.png
            2019-09-04_11h40_47.png
            2019-09-04_15h25_50.png
            2019-09-04_16h41_31.png
            2019-09-04_16h50_04.png
            2019-09-04_17h47_20.png
            2019-09-04_17h56_03.png
            2019-09-04_18h05_40.png
            2019-09-04_18h09_36.png
            2019-09-04_IP.png
            2019-09-04_IPI.png
            2019-09-04_PYNQ.png
            2019-09-05_10h45_29.png
            2019-09-05_10h48_40.png
            2019-09-05_10h49_55.png
            2019-09-05_10h51_08.png
            2019-09-05_10h51_47.png
            2019-09-05_10h52_47.png
            2019-09-05_10h53_41.png
            2019-09-06_16h54_49.png
            2019-09-10_09h45_25.png
            2019-09-10_10h45_15.png
            2019-09-10_11h01_34.png
            2019-09-10_11h02_03.png
            2019-09-10_11h03_34.png
            2019-09-10_11h04_20.png
            2019-09-10_11h56_45.png
            2019-09-10_12h12_24.png
            2019-09-10_12h22_43.png
            2019-09-10_12h23_14.png
            2019-09-10_13h39_29.png
            2019-09-10_13h43_06.png
            2019-09-10_13h55_40.png
            2019-09-13_13h07_26.png
            IMG_7522.jpg
        petalinux/
            pynq_dpu.bsp
        vivado/
            design_1-.tcl
            design_1.tcl
        zynq7020_dnndk_v3.0/
            install.sh
            install.sh.orig
    pynq_dpu/
        pynq_dpu.xpr
        pynq_dpu.cache/
        pynq_dpu.gen/
        pynq_dpu.hw/
            pynq_dpu.lpr
        pynq_dpu.ip_user_files/
        pynq_dpu.sim/
        pynq_dpu.srcs/
    vitis/
        .analytics
        IDE.log
        .metadata/
            .lock
            .log
            version.ini
        RemoteSystemsTempFiles/
            .project
    vivado-library/
        .gitignore
        License.txt
        README.md
        if/
        ip/
        module/
